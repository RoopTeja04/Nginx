events {
  worker_connections 1024;
}

http {
  sendfile on;
  keepalive_timeout 65;

  upstream auth_service {
    server system-design-app-auth-service-server-1.onrender.com:80;
  }

  upstream feed_service {
    server system-design-app-feed-service-server-1.onrender.com:80;
  }

  upstream profile_service {
    server system-design-app-profile-service-server.onrender.com:80;
  }

  server {
    listen 80;

    # Auth Service
    location / {
      proxy_pass https://auth_service;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Feed Service
    location /api/ {
      proxy_pass https://feed_service;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Profile Service
    location /profile-service/ {
      proxy_pass https://profile_service;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
  }
}

